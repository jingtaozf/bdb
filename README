# -*- encoding:utf-8 Mode: org; -*- ---
* TODO
** setup db environment before open db file
http://blog.sina.com.cn/s/blog_502c8cc40100yqkj.html
#+BEGIN_SRC c
  DB_ENV *dbenv;
  
  DB *dbp;
  
  int ret;
  
  if ((ret = db_env_create(&dbenv, 0)) != 0) {
  
      fprintf(errfp, "%s: %s\n", progname, db_strerror(ret));
  
      return (1);
  
  }
  
  dbenv->set_errfile(dbenv, errfp);
  
  dbenv->set_errpfx(dbenv, progname);
  
  if ((ret = dbenv->set_cachesize(dbenv, 0, 64 * 1024, 0)) != 0) {
  
      dbenv->err(dbenv, ret, "set_cachesize");
  
      dbenv->close(dbenv, 0);
  
      return (1);
  
  }
  
  (void)dbenv->set_data_dir(dbenv, data_dir);
  
  if ((ret = dbenv->open(dbenv, home, DB_CREATE | DB_INIT_LOCK | DB_INIT_LOG | DB_INIT_MPOOL | DB_INIT_TXN, 0644)) != 0) {
  
      dbenv->err(dbenv, ret, "environment open: %s", home);
  
      dbenv->close(dbenv, 0);
  
      return (1);
  
  }
  
  if ((ret = db_create(&dbp, dbenv, 0)) != 0){
  
      fprintf(errfp, "%s: %s\n", progname, db_strerror(ret));
  
      return (1);
  
  }
  
  if ((ret = dbp->open(dbp, NULL, "exenv_db1.db", NULL, DB_BTREE, DB_CREATE,0644)) != 0){
  
      fprintf(stderr, "database open: %s\n", db_strerror(ret));
  
      return (1);
  
  }
  
  if ((ret = dbp->close(dbp, 0)) != 0) {
  
      fprintf(stderr, "database close: %s\n", db_strerror(ret));
  
      return (1);
  
  }
  
  if ((ret = dbenv->close(dbenv, 0)) != 0) {
  
      fprintf(stderr, "DB_ENV->close: %s\n", db_strerror(ret));
  
      return (1);
  
  }
  
  return (0);
  
  
#+END_SRC
